<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-05XLDKW0MN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-05XLDKW0MN');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIY System Registration - MicroGrid</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base Styles */
        :root {
            --brand-green: #10B981;
            --brand-green-dark: #065f46;
            --brand-green-medium: #059669;
            --brand-green-darker: #047857;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 1000;
            padding: 1rem 0;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(16, 185, 129, 0.15);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .logo img {
            height: 50px;
            width: auto;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #10B981;
        }

        .header-buttons {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cta-button {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
        }

        .cta-button:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .cta-button-outline {
            background: transparent;
            color: var(--brand-green);
            padding: 0.5rem 1rem;
            border: 2px solid var(--brand-green);
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
        }

        .cta-button-outline:hover {
            background: rgba(16, 185, 129, 0.05);
        }

        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .section-header p {
            font-size: 1.1rem;
            color: #6b7280;
        }

        /* Additional styles for DIY registration page */
        .registration-hero {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            padding: 120px 0 80px;
            text-align: center;
        }

        .registration-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .registration-hero p {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
            opacity: 0.9;
        }

        .registration-form-section {
            padding: 140px 0 80px;
            background: #f8fafc;
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #374151;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #059669;
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-top: 0.25rem;
        }

        .checkbox-group label {
            margin-bottom: 0;
            font-weight: 400;
            line-height: 1.5;
        }

        .submit-btn {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, #047857 0%, #065f46 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
        }

        .requirements-section {
            padding: 80px 0;
            background: white;
        }

        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .requirement-card {
            text-align: center;
            padding: 2rem;
            border-radius: 15px;
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            border: 1px solid #d1fae5;
        }

        .requirement-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .requirement-card h3 {
            color: #059669;
            margin-bottom: 1rem;
        }

        .help-section {
            padding: 80px 0;
            background: #f8fafc;
        }

        .help-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .help-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .help-btn {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .help-btn:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .help-btn.secondary {
            background: transparent;
            color: #059669;
            border: 2px solid #059669;
        }

        .help-btn.secondary:hover {
            background: #059669;
            color: white;
        }

        .file-upload-container {
            margin-top: 0.5rem;
        }

        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background: #f9fafb;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: #059669;
            background: #f0fdf4;
        }

        .file-upload-area.drag-over {
            border-color: #059669;
            background: #ecfdf5;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .upload-text {
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .upload-subtext {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .file-list {
            margin-top: 1rem;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .file-item:hover {
            border-color: #059669;
            box-shadow: 0 2px 8px rgba(5, 150, 105, 0.1);
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }

        .file-icon {
            font-size: 1.5rem;
        }

        .file-details {
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }

        .file-size {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .file-remove {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .file-remove:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            color: #333;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 1rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                gap: 0;
            }

            .nav-links.active {
                display: flex;
            }

            .nav-links li {
                padding: 0.75rem 0;
                border-bottom: 1px solid #f0f0f0;
            }

            .nav-links li:last-child {
                border-bottom: none;
            }

            .registration-hero h1 {
                font-size: 2rem;
            }

            .form-container {
                padding: 2rem 1.5rem;
                margin: 0 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .requirements-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .help-buttons {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 640px) {
            .cta-button.hide-mobile {
                display: none;
            }
        }

        /* Sticky CTA Bar */
        .sticky-cta-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid rgba(16, 185, 129, 0.15);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
            padding: 1rem;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .cta-bar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .cta-bar-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
            flex-shrink: 0;
        }

        .cta-bar-buttons {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .cta-bar-primary {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cta-bar-primary:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        /* Add padding to body to account for sticky bar */
        body {
            padding-bottom: 100px;
        }

        @media (max-width: 768px) {
            .cta-bar-content {
                flex-direction: column;
                text-align: center;
                gap: 0.75rem;
            }

            .cta-bar-text {
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }

            .cta-bar-buttons {
                width: 100%;
                justify-content: center;
            }

            .cta-bar-primary {
                flex: 1;
                min-width: 140px;
                padding: 0.75rem;
                font-size: 0.9rem;
            }

            .sticky-cta-bar {
                padding: 1rem 0.75rem;
            }

            body {
                padding-bottom: 140px;
            }
        }

        @media (max-width: 480px) {
            .cta-bar-primary {
                width: 100%;
                padding: 1rem;
            }

            body {
                padding-bottom: 160px;
            }
        }

        /* Footer */
        footer {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            color: white;
            padding: 2.5rem 0;
            border-top: 1px solid rgba(16, 185, 129, 0.1);
        }

        .footer-content {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
        }

        .footer-brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .footer-logo-icon {
            width: 32px;
            height: 32px;
            background: var(--brand-green);
            border-radius: 12px;
            flex-shrink: 0;
        }

        .footer-logo-text {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .footer-logo-title {
            font-weight: 800;
            font-size: 1rem;
        }

        .footer-logo-subtitle {
            font-size: 0.875rem;
            color: #9CA3AF;
        }

        .footer-tagline {
            font-size: 1rem;
            font-weight: 600;
            color: #e2e8f0;
            letter-spacing: -0.015em;
        }

        .footer-nav {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
        }

        .footer-nav a {
            color: #9CA3AF;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-nav a:hover {
            color: white;
        }

        .footer-copyright {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 0.75rem;
            margin-top: 0.75rem;
            text-align: center;
        }

        .footer-copyright p {
            font-size: 0.875rem;
            color: #9CA3AF;
            margin: 0;
        }

        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="container">
            <a href="index.html" class="logo">
                <img src="assets/images/microgrid_logo.png" alt="MicroGrid" height="50">
            </a>
            <ul class="nav-links" id="navLinks">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#join-movement">How It Works</a></li>
                <li><a href="index.html#nem">California (NEM 3.0)</a></li>
                <li><a href="index.html#impact">Results</a></li>
                <li><a href="index.html#compat">Compatibility</a></li>
                <li><a href="index.html#faq">FAQ</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
            <div class="header-buttons">
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">‚ò∞</button>
                <a href="diy-registration.html" class="cta-button hide-mobile">Start Free</a>
                <a href="https://apps.apple.com/us/app/dgrid/id6747276150" class="cta-button-outline">Download App</a>
            </div>
        </nav>
    </header>

    <!-- Registration Form Section -->
    <section class="registration-form-section">
        <div class="container">
            <div class="form-container">
                <div class="section-header">
                    <h2>Activate Your Smart Battery in 2 Minutes</h2>
                    <p>No installer visit. No cost. Link your account to unlock AI optimization and start earning.</p>
                </div>

                <form id="diyForm" action="#" method="POST">
                    
                    <h2 style="font-size: 1.5rem; color: #059669; margin-bottom: 0.5rem;">Step 1 ‚Äî Tell Us About Your Current Usage</h2>
                    <p style="color: #6b7280; margin-bottom: 2rem;">This helps us check compatibility and prepare your optimization plan.</p>
                    
                    <div class="form-group full-width">
                        <label for="fullName">Full Name or Preferred Name *</label>
                        <input type="text" id="fullName" name="fullName" placeholder="Enter your full name or preferred name" required>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" name="email" placeholder="you@example.com" required>
                            <small style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem; display: block;">We'll send your setup summary and next steps.</small>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" name="phone" placeholder="(800) 555-0100 or 8005550100">
                            <small style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem; display: block;">US phone numbers only. Enter 10 digits.</small>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="address">Address</label>
                        <input type="text" id="address" name="address" placeholder="Street address (optional)">
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="city">City *</label>
                            <input type="text" id="city" name="city" placeholder="City" required>
                            <small style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem; display: block;">Certain utility rules differ by location.</small>
                        </div>
                        <div class="form-group">
                            <label for="state">State *</label>
                            <select id="state" name="state" required>
                                <option value="">Select State</option>
                                <option value="California">California</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="utilityCompany">Utility Company</label>
                        <select id="utilityCompany" name="utilityCompany">
                            <option value="">Select Utility Company</option>
                            <option value="PG&E">Pacific Gas & Electric (PG&E)</option>
                            <option value="SCE">Southern California Edison (SCE)</option>
                            <option value="SDG&E">San Diego Gas & Electric (SDG&E)</option>
                            <option value="SMUD">Sacramento Municipal Utility District (SMUD)</option>
                            <option value="LADWP">Los Angeles Department of Water and Power (LADWP)</option>
                            <option value="Other">Other California Utility</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label for="electricityBills">Upload Recent Electricity Bills <span id="billsRequiredIndicator" style="display: none; color: #ef4444;">*</span></label>
                        <div class="file-upload-container">
                            <div class="file-upload-area" id="fileUploadArea">
                                <div class="upload-icon">üìÑ</div>
                                <p class="upload-text">Click to upload or drag and drop</p>
                                <p class="upload-subtext" id="billsSubtext">Upload up to 12 files (PDF or images) ‚Äî more recent bills are better</p>
                                <input type="file" id="electricityBills" name="electricityBills" accept=".pdf,.jpg,.jpeg,.png" multiple style="display: none;">
                            </div>
                            <div id="fileList" class="file-list"></div>
                        </div>
                        <small style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem; display: block;">
                            Helps our AI estimate your savings faster. <span id="billsHelpText" style="display: inline;">You can skip this step.</span>
                        </small>
                    </div>

                    <hr style="border: none; border-top: 2px solid #e5e7eb; margin: 2.5rem 0;">

                    <h2 style="font-size: 1.5rem; color: #059669; margin-bottom: 0.5rem;">Step 2 ‚Äî Understand Your Earnings Potential</h2>
                    <p style="color: #6b7280; margin-bottom: 1.5rem;">Two ways to provide system information:</p>

                    <!-- Preferred Path: Direct Connection -->
                    <div style="background: #f0fdf4; border: 2px solid #10B981; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: start; gap: 0.75rem; margin-bottom: 1rem;">
                            <span style="font-size: 1.5rem;">‚ö°</span>
                            <div>
                                <h3 style="font-size: 1.1rem; color: #059669; font-weight: 700; margin-bottom: 0.25rem;">Recommended: Direct Connection</h3>
                                <p style="color: #047857; font-size: 0.95rem; line-height: 1.6; margin: 0 0 0.75rem 0;">
                                    Enter your inverter credentials below for instant connection. Read-only access only ‚Äî we won't control your system without consent.
                                </p>
                                <p style="color: #065f46; font-size: 0.875rem; line-height: 1.6; margin: 0; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 3px solid #10B981;">
                                    <strong>‚ÑπÔ∏è About these credentials:</strong> Your installer should have created the inverter web service username and password during the installation process. These are different from your consumer app login. If you don't have these credentials, please contact your installer to obtain them.
                                </p>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="inverterManufacturer">Inverter Brand *</label>
                            <select id="inverterManufacturer" name="inverterManufacturer" required>
                                <option value="">Select your brand</option>
                                <option value="Enphase">Enphase</option>
                                <option value="SolarEdge">SolarEdge</option>
                                <option value="Sol-Ark">Sol-Ark</option>
                                <option value="EG4">EG4</option>
                                <option value="Franklin">Franklin</option>
                                <option value="Liniotech">Liniotech</option>
                                <option value="Other">Other</option>
                            </select>
                            <small style="color: #047857; font-size: 0.875rem; margin-top: 0.5rem; display: block;">So we can connect to the right data source.</small>
                        </div>

                        <div class="form-group full-width" id="otherManufacturerGroup" style="display: none;">
                            <label for="otherManufacturer">Please specify manufacturer *</label>
                            <input type="text" id="otherManufacturer" name="otherManufacturer" placeholder="Enter manufacturer name">
                            <small style="color: #047857; font-size: 0.875rem; margin-top: 0.5rem; display: block;">Please provide the name of your inverter manufacturer</small>
                        </div>

                        <div class="form-group full-width" id="serialNumberGroup" style="display: none;">
                            <label for="serialNumber">Inverter Serial Number *</label>
                            <input type="text" id="serialNumber" name="serialNumber" placeholder="Enter inverter serial number">
                            <small style="color: #047857; font-size: 0.875rem; margin-top: 0.5rem; display: block;">Required for Franklin and EG4 inverters</small>
                        </div>

                        <div class="form-group full-width">
                            <label for="installationDate">System Installation Date</label>
                            <input type="date" id="installationDate" name="installationDate">
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="username">Inverter Web Service Username</label>
                                <input type="text" id="username" name="username" placeholder="Inverter web service username">
                                <small style="color: #047857; font-size: 0.875rem; margin-top: 0.5rem; display: block;">Used only to read performance data. We never share or sell data.</small>
                            </div>
                            <div class="form-group">
                                <label for="password">Inverter Web Service Password</label>
                                <input type="password" id="password" name="password" placeholder="Inverter web service password">
                                <small style="color: #047857; font-size: 0.875rem; margin-top: 0.5rem; display: block;">Encrypted in transit and at rest. You can change it later.</small>
                            </div>
                        </div>
                    </div>

                    <!-- Alternative: Simulation Mode -->
                    <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                            <span style="font-size: 1.5rem;">üìä</span>
                            <div style="flex: 1;">
                                <h3 style="font-size: 1.1rem; color: #374151; font-weight: 700; margin-bottom: 0.5rem;">Alternative: Tell Us Your System Specs</h3>
                                <p style="color: #6b7280; font-size: 0.95rem; line-height: 1.6; margin-bottom: 1rem;">
                                    Don't have your inverter credentials? No problem. We can estimate your savings based on your system specifications and utility bills.
                                </p>
                                
                                <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem; padding: 0.75rem; background: #fffbeb; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <strong>üí° Note:</strong> This approach only provides high level estimates. Actual results may vary. Provide your inverter credentials to improve accuracy.
                                </p>

                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="batteryCapacity">Battery Capacity (kWh) <span id="batteryCapacityRequired" style="display: none; color: #ef4444;">*</span></label>
                                        <input type="number" id="batteryCapacity" name="batteryCapacity" placeholder="e.g., 13.5" step="0.1" min="0">
                                        <small style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem; display: block;">
                                            Total usable battery storage capacity.
                                        </small>
                                    </div>
                                    <div class="form-group">
                                        <label for="pvWattage">Solar Panel Capacity (kW) <span id="pvWattageRequired" style="display: none; color: #ef4444;">*</span></label>
                                        <input type="number" id="pvWattage" name="pvWattage" placeholder="e.g., 8.5" step="0.1" min="0">
                                        <small style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem; display: block;">
                                            Total solar panel capacity in kilowatts.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="additionalNotes">Additional Notes</label>
                        <textarea id="additionalNotes" name="additionalNotes" placeholder="Any additional information about your system or setup..."></textarea>
                    </div>

                    <div id="securityBadge" style="background: #f0fdf4; border: 2px solid #d1fae5; border-radius: 12px; padding: 1.5rem; margin: 2rem 0;">
                        <p style="margin: 0; line-height: 1.8; color: #047857;">
                            üëç Read-only data access<br>
                            üëç No hardware changes<br>
                            üëç Disconnect anytime in one click
                        </p>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="terms" name="terms" required>
                        <label for="terms">I agree to the <a href="terms.html" style="color: #059669;">Terms of Service</a> and <a href="privacy.html" style="color: #059669;">Privacy Policy</a> *</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="vppParticipation" name="vppParticipation">
                        <label for="vppParticipation">I want to participate in Virtual Power Plant programs and earn money from my battery</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="marketing" name="marketing">
                        <label for="marketing">I would like to receive updates about MicroGrid products and VPP opportunities</label>
                    </div>

                    <button type="submit" class="submit-btn" id="submitBtn">Connect System or Get Savings Estimate</button>
                    
                    <p style="text-align: center; margin-top: 1rem; color: #6b7280; font-size: 0.95rem;" id="submitHelpText">üí° You'll receive your results within 24 hours.</p>

                    <p style="text-align: center; margin-top: 1rem;">
                        <a href="mailto:support@microvpp.com" style="color: #059669; text-decoration: none; font-weight: 500;">Need help connecting?</a>
                    </p>

                    <small style="display: block; text-align: center; margin-top: 1.5rem; color: #6b7280; font-size: 0.875rem; line-height: 1.6;">
                        By continuing you agree to our <a href="privacy.html" style="color: #059669;">Privacy Policy</a>.  
                        We only read system data to generate savings; we never sell personal data.
                    </small>
                </form>
            </div>
        </div>
    </section>

    <!-- Help Section -->
    <section class="help-section">
        <div class="container">
            <div class="help-content">
                <div class="section-header">
                    <h2>Need Help?</h2>
                    <p>Our team is here to help you connect your system successfully</p>
                </div>
                <div class="help-buttons">
                    <a href="mailto:support@microgrid.com" class="help-btn secondary">Contact Support</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <span class="footer-logo-icon"></span>
                    <div class="footer-logo-text">
                        <div class="footer-logo-title">MicroVPP‚Ñ¢</div>
                        <div class="footer-logo-subtitle">by MicroGrid</div>
                    </div>
                </div>
                <div class="footer-tagline">Smarter homes. Stronger grids.</div>
                <nav class="footer-nav">
                    <a href="index.html">Home</a>
                    <a href="about.html">About</a>
                    <a href="privacy.html">Privacy</a>
                    <a href="terms.html">Terms</a>
                    <a href="mailto:info@microvpp.com">Contact</a>
                </nav>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2025 MicroGrid LLC. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Sticky CTA Bar -->
    <div class="sticky-cta-bar">
        <div class="cta-bar-content">
            <div class="cta-bar-text">Ready to activate your smart battery?</div>
            <div class="cta-bar-buttons">
                <a href="https://apps.apple.com/us/app/dgrid/id6747276150" class="cta-bar-primary">Download App</a>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const navLinks = document.getElementById('navLinks');
        
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', function() {
                navLinks.classList.toggle('active');
                this.textContent = navLinks.classList.contains('active') ? '‚úï' : '‚ò∞';
            });

            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('nav')) {
                    navLinks.classList.remove('active');
                    mobileMenuBtn.textContent = '‚ò∞';
                }
            });

            // Close menu when clicking a link
            navLinks.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function() {
                    navLinks.classList.remove('active');
                    mobileMenuBtn.textContent = '‚ò∞';
                });
            });
        }

        // API Configuration
        const API_BASE_URL = 'https://3dbhitxwoc.execute-api.us-east-2.amazonaws.com/dev';
        const REGISTER_ENDPOINT = '/auth/signup';

        // File upload handling
        let uploadedFiles = [];
        const MAX_FILES = 12;
        const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB per file

        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('electricityBills');
        const fileList = document.getElementById('fileList');

        // Click to upload
        fileUploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        // Handle file selection
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // Drag and drop handlers
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('drag-over');
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('drag-over');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('drag-over');
            handleFiles(e.dataTransfer.files);
        });

        function handleFiles(files) {
            const newFiles = Array.from(files);
            
            // Check total file count
            if (uploadedFiles.length + newFiles.length > MAX_FILES) {
                alert(`You can only upload up to ${MAX_FILES} files. You currently have ${uploadedFiles.length} file(s).`);
                return;
            }

            // Validate and add files
            newFiles.forEach(file => {
                // Check file size
                if (file.size > MAX_FILE_SIZE) {
                    alert(`File "${file.name}" is too large. Maximum size is 10MB.`);
                    return;
                }

                // Check file type
                const validTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
                if (!validTypes.includes(file.type)) {
                    alert(`File "${file.name}" has an invalid type. Please upload PDF or image files.`);
                    return;
                }

                uploadedFiles.push(file);
            });

            displayFiles();
            fileInput.value = ''; // Reset input
        }

        function displayFiles() {
            fileList.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                const fileIcon = getFileIcon(file.type);
                const fileSize = formatFileSize(file.size);
                
                fileItem.innerHTML = `
                    <div class="file-info">
                        <span class="file-icon">${fileIcon}</span>
                        <div class="file-details">
                            <span class="file-name">${file.name}</span>
                            <span class="file-size">${fileSize}</span>
                        </div>
                    </div>
                    <button type="button" class="file-remove" onclick="removeFile(${index})">√ó</button>
                `;
                
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            displayFiles();
        }

        function getFileIcon(fileType) {
            if (fileType === 'application/pdf') return 'üìÑ';
            if (fileType.startsWith('image/')) return 'üñºÔ∏è';
            return 'üìé';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

         // Dynamic validation based on credentials input
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const batteryCapacityInput = document.getElementById('batteryCapacity');
        const pvWattageInput = document.getElementById('pvWattage');
        const batteryCapacityRequired = document.getElementById('batteryCapacityRequired');
        const pvWattageRequired = document.getElementById('pvWattageRequired');
        const batteryCapacityHelpText = document.getElementById('batteryCapacityHelpText');
        const pvWattageHelpText = document.getElementById('pvWattageHelpText');
        const billsRequiredIndicator = document.getElementById('billsRequiredIndicator');
        const billsHelpText = document.getElementById('billsHelpText');
        const billsSubtext = document.getElementById('billsSubtext');

        // Function to update field requirements based on whether credentials are provided
        function updateFieldRequirements() {
            const hasCredentials = usernameInput.value.trim() !== '' && passwordInput.value.trim() !== '';
            
            if (hasCredentials) {
                // If credentials provided, make battery/solar/bills optional
                batteryCapacityRequired.style.display = 'none';
                pvWattageRequired.style.display = 'none';
                batteryCapacityInput.removeAttribute('required');
                pvWattageInput.removeAttribute('required');
                billsRequiredIndicator.style.display = 'none';
                billsHelpText.innerHTML = '<span style="color: #059669;">‚úì You can skip this step.</span>';
                billsSubtext.innerHTML = 'Upload up to 12 files (PDF or images) ‚Äî more recent bills are better';
            } else {
                // If no credentials, make battery/solar/bills required for simulation
                batteryCapacityRequired.style.display = 'inline';
                pvWattageRequired.style.display = 'inline';
                batteryCapacityInput.setAttribute('required', 'required');
                pvWattageInput.setAttribute('required', 'required');
                billsRequiredIndicator.style.display = 'inline';
                billsHelpText.innerHTML = '<strong style="color: #ef4444;">At least one electricity bill is required for savings estimates.</strong>';
                billsSubtext.innerHTML = 'Required: Upload at least 1 file (PDF or images) ‚Äî more recent bills provide better estimates';
            }
        }

        // Listen for changes in username and password fields
        usernameInput.addEventListener('input', updateFieldRequirements);
        passwordInput.addEventListener('input', updateFieldRequirements);
        
        // Initialize on page load
        updateFieldRequirements();

        // Handle manufacturer-specific field visibility
        document.getElementById('inverterManufacturer').addEventListener('change', function() {
            const manufacturer = this.value;
            const serialNumberGroup = document.getElementById('serialNumberGroup');
            const serialNumberInput = document.getElementById('serialNumber');
            const otherManufacturerGroup = document.getElementById('otherManufacturerGroup');
            const otherManufacturerInput = document.getElementById('otherManufacturer');
            
            // Show serial number field for Franklin and EG4
            if (manufacturer === 'Franklin' || manufacturer === 'EG4') {
                serialNumberGroup.style.display = 'block';
                serialNumberInput.required = true;
            } else {
                serialNumberGroup.style.display = 'none';
                serialNumberInput.required = false;
                serialNumberInput.value = ''; // Clear the field when hidden
            }
            
            // Show other manufacturer field when "Other" is selected
            if (manufacturer === 'Other') {
                otherManufacturerGroup.style.display = 'block';
                otherManufacturerInput.required = true;
            } else {
                otherManufacturerGroup.style.display = 'none';
                otherManufacturerInput.required = false;
                otherManufacturerInput.value = ''; // Clear the field when hidden
            }
        });

        // Generate a unique inverter ID
        function generateInverterId() {
            return 'INV-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }

        // Format phone number to E.164 format (required by AWS Cognito)
        function formatPhoneToE164(phone) {
            if (!phone) return null;
            
            // Remove all non-digit characters
            const digits = phone.replace(/\D/g, '');
            
            // Handle different formats
            if (digits.length === 10) {
                // US number without country code: add +1
                return '+1' + digits;
            } else if (digits.length === 11 && digits.startsWith('1')) {
                // US number with country code 1: add +
                return '+' + digits;
            } else if (phone.startsWith('+')) {
                // Already in E.164 format
                return phone;
            } else if (digits.length === 11) {
                // 11 digits, assume US: add +
                return '+' + digits;
            }
            
            // Default: assume US number and add +1
            return '+1' + digits;
        }

         // Map form data to API payload
        function mapFormToPayload(formData) {
            const manufacturer = formData.get('inverterManufacturer');
            const otherManufacturer = formData.get('otherManufacturer');
            const inverterId = generateInverterId();
            const username = formData.get('username');
            const password = formData.get('password');
            const hasCredentials = username && username.trim() !== '' && password && password.trim() !== '';
            const isSimulationMode = !hasCredentials;
            
            // Determine the inverter type (use otherManufacturer if "Other" is selected)
            const inverterManufacturer = manufacturer === 'Other' && otherManufacturer 
                ? otherManufacturer 
                : manufacturer;

            // Build the info object with all additional user and system information
            const info = {
                contact: {
                    name: formData.get('fullName') || null,
                    email: formData.get('email'),
                    phone: formData.get('phone') || null
                },
                location: {
                    address: formData.get('address') || null,
                    city: formData.get('city'),
                    state: formData.get('state')
                },
                system: {
                    battery_capacity_kwh: formData.get('batteryCapacity') ? parseFloat(formData.get('batteryCapacity')) : null,
                    pv_wattage_kw: formData.get('pvWattage') ? parseFloat(formData.get('pvWattage')) : null,
                    installation_date: formData.get('installationDate') || null,
                    utility_company: formData.get('utilityCompany') || null,
                    serial_number: formData.get('serialNumber') || null
                },
                registration: {
                    mode: isSimulationMode ? 'simulation' : 'direct_connection',
                    vpp_participation: formData.get('vppParticipation') === 'on',
                    marketing_consent: formData.get('marketing') === 'on',
                    terms_accepted: formData.get('terms') === 'on',
                    registration_date: new Date().toISOString(),
                    registration_source: 'diy-web-form'
                },
                electricity_bills: {
                    uploaded_count: uploadedFiles.length,
                    files: uploadedFiles.map(file => ({
                        name: file.name,
                        size: file.size,
                        type: file.type
                    }))
                },
                notes: formData.get('additionalNotes') || null
            };

            // Build the API payload
            const payload = {
                entity_type: "inverter",
                username: formData.get('fullName') || null,
                email: formData.get('email'),
                phone_number: formatPhoneToE164(formData.get('phone')),
                full_address: formData.get('address') || null,
                city: formData.get('city') || null,
                state: formData.get('state') || null,
                zip: formData.get('zip') || null,
                country: "US",
                latitude: null,
                longitude: null,
                timezone: null,
                locale: "en-US",
                inverter_inverter_id: inverterId,
                inverter_inverter_type: "hybrid_inverter",
                inverter_manufacturer: inverterManufacturer,
                inverter_serial_number: formData.get('serialNumber'),
                inverter_monitoring_id: null, // Web service username
                inverter_monitoring_token: null, // Web service password
                inverter_monitoring_url: null,
                inverter_api_key: formData.get('username'), // Using username as API key
                inverter_api_secret: formData.get('password'), // Using password as API secret
                info: info,
                site_id: null, // Let the API generate a site_id
                site_type: "residential", // Default site type for DIY registrations
                installation_date: formData.get('installationDate') || null,
            };

            return payload;
        }

        // Submit form to API
        async function submitRegistration(payload) {
            const submitBtn = document.querySelector('.submit-btn');
            const originalText = submitBtn.textContent;
            
            try {
                // Show loading state
                submitBtn.disabled = true;
                submitBtn.textContent = 'Connecting Your System...';
                submitBtn.style.opacity = '0.7';

                // TODO: Handle actual file uploads
                // If files are uploaded, they should be sent to a separate endpoint
                // (e.g., presigned S3 URLs) before or after the main registration
                // For now, file metadata is included in the payload

                const response = await fetch(API_BASE_URL + REGISTER_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => null);
                    throw new Error(
                        errorData?.detail || 
                        `Registration failed with status: ${response.status}`
                    );
                }

                const result = await response.json();
                console.log('Registration successful:', result);

                 // Build success message based on mode
                const isSimulationMode = payload.info.registration.mode === 'simulation';
                let successMessage = '';
                
                if (isSimulationMode) {
                    successMessage = 'üéâ Success! We\'re preparing your savings estimate!\n\n';
                    
                    if (uploadedFiles.length > 0) {
                        successMessage += `We've received ${uploadedFiles.length} electricity bill file(s) for analysis.\n\n`;
                    }
                    
                    successMessage += 
                        'What happens next:\n' +
                        '1. Our AI analyzes your utility bills and system specs\n' +
                        '2. You\'ll receive a detailed savings estimate within 24 hours\n' +
                        '3. We\'ll email instructions to connect your actual system\n' +
                        '4. Download the MicroVPP‚Ñ¢ app to view your results\n\n' +
                        'Check your email (' + payload.email + ') for your savings estimate!';
                } else {
                    successMessage = 'üéâ Success! Your system is being connected to MicroGrid\'s VPP network!\n\n';
                    
                    if (uploadedFiles.length > 0) {
                        successMessage += `We've received ${uploadedFiles.length} electricity bill file(s) for additional analysis.\n\n`;
                    }
                    
                    successMessage += 
                        'What\'s next:\n' +
                        '1. We\'re verifying your connection (usually takes a few minutes)\n' +
                        '2. Download the MicroVPP‚Ñ¢ app from the App Store\n' +
                        '3. Sign in with your email: ' + payload.email + '\n' +
                        '4. Start monitoring your system and earning from VPP programs\n\n' +
                        'Check your email for confirmation and next steps!';
                }

                // Show success message
                alert(successMessage);

                // Reset form
                document.getElementById('diyForm').reset();
                
                // Clear uploaded files
                uploadedFiles = [];
                displayFiles();
                
                // Hide conditional fields after reset
                document.getElementById('serialNumberGroup').style.display = 'none';
                document.getElementById('serialNumber').required = false;
                document.getElementById('otherManufacturerGroup').style.display = 'none';
                document.getElementById('otherManufacturer').required = false;

                // Optionally redirect to app store or success page
                // window.location.href = 'https://apps.apple.com/us/app/dgrid/id6747276150';

            } catch (error) {
                console.error('Registration error:', error);
                
                // Show error message
                alert(
                    '‚ùå Registration Error\n\n' +
                    'We encountered an issue while connecting your system:\n' +
                    error.message + '\n\n' +
                    'Please try again or contact support@microvpp.com for assistance.'
                );
            } finally {
                // Restore button state
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                submitBtn.style.opacity = '1';
            }
        }

         // Form submit handler
        document.getElementById('diyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const username = formData.get('username');
            const password = formData.get('password');
            const hasCredentials = username && username.trim() !== '' && password && password.trim() !== '';
            
            // Determine if we're in simulation mode (no credentials provided)
            const isSimulationMode = !hasCredentials;
            
            // Custom validation for simulation mode
            if (isSimulationMode) {
                let errors = [];
                
                // Check required fields for simulation
                const batteryCapacity = formData.get('batteryCapacity');
                const pvWattage = formData.get('pvWattage');
                
                if (!batteryCapacity || parseFloat(batteryCapacity) <= 0) {
                    errors.push('‚Ä¢ Battery capacity is required when credentials are not provided');
                    document.getElementById('batteryCapacity').style.borderColor = '#ef4444';
                } else {
                    document.getElementById('batteryCapacity').style.borderColor = '#e5e7eb';
                }
                
                if (!pvWattage || parseFloat(pvWattage) <= 0) {
                    errors.push('‚Ä¢ Solar panel capacity is required when credentials are not provided');
                    document.getElementById('pvWattage').style.borderColor = '#ef4444';
                } else {
                    document.getElementById('pvWattage').style.borderColor = '#e5e7eb';
                }
                
                if (uploadedFiles.length === 0) {
                    errors.push('‚Ä¢ At least one electricity bill is required when credentials are not provided');
                    document.getElementById('fileUploadArea').style.borderColor = '#ef4444';
                } else {
                    document.getElementById('fileUploadArea').style.borderColor = '#d1d5db';
                }
                
                if (errors.length > 0) {
                    alert('‚ö†Ô∏è Missing Required Information:\n\n' + 
                          'Since you haven\'t provided inverter credentials, we need:\n\n' +
                          errors.join('\n') + 
                          '\n\nüí° Tip: Enter your inverter username and password above to skip these requirements.');
                    return;
                }
            }
            
            // Basic form validation for all required fields
            const requiredFields = this.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                // Only validate visible required fields
                if (field.offsetParent !== null && !field.value.trim()) {
                    field.style.borderColor = '#ef4444';
                    isValid = false;
                } else {
                    field.style.borderColor = '#e5e7eb';
                }
            });
            
            if (isValid) {
                // Map form data to API payload
                const payload = mapFormToPayload(formData);
                
                // Log payload for debugging
                console.log('Sending registration payload:', payload);
                
                // Submit to API
                submitRegistration(payload);
            } else {
                alert('Please fill in all required fields.');
            }
        });
    </script>
</body>
</html> 